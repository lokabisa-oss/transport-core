{
  "description": "Retry behavior test vectors for transport-core",
  "cases": [
    {
      "name": "retry_on_timeout_error",
      "input": {
        "method": "GET",
        "attempt": 1,
        "error": "TimeoutError"
      },
      "expected": {
        "action": "RETRY",
        "next_attempt": 2
      }
    },
    {
      "name": "retry_on_network_error",
      "input": {
        "method": "GET",
        "attempt": 1,
        "error": "NetworkError"
      },
      "expected": {
        "action": "RETRY"
      }
    },
    {
      "name": "retry_on_rate_limited_with_hint",
      "input": {
        "method": "GET",
        "attempt": 1,
        "error": "RateLimited",
        "retry_after_ms": 3000
      },
      "expected": {
        "action": "RETRY"
      }
    },
    {
      "name": "retry_on_401_with_refresh",
      "input": {
        "method": "GET",
        "attempt": 1,
        "status": 401,
        "auth_decision": "RefreshAndRetry"
      },
      "expected": {
        "action": "REFRESH_AND_RETRY",
        "next_attempt": 2
      }
    },
    {
      "name": "fail_on_401_refresh_failed",
      "input": {
        "method": "GET",
        "attempt": 1,
        "status": 401,
        "auth_decision": "Fail"
      },
      "expected": {
        "action": "FAIL"
      }
    },
    {
      "name": "fail_on_403",
      "input": {
        "method": "GET",
        "attempt": 1,
        "status": 403
      },
      "expected": {
        "action": "FAIL"
      }
    },
    {
      "name": "fail_on_404",
      "input": {
        "method": "GET",
        "attempt": 1,
        "status": 404
      },
      "expected": {
        "action": "FAIL"
      }
    },
    {
      "name": "fail_on_non_idempotent_post_without_key",
      "input": {
        "method": "POST",
        "attempt": 1,
        "error": "NetworkError"
      },
      "expected": {
        "action": "FAIL"
      }
    },
    {
      "name": "retry_on_non_idempotent_post_with_idempotency_key",
      "input": {
        "method": "POST",
        "attempt": 1,
        "error": "NetworkError",
        "idempotency_key": "abc123",
        "allow_non_idempotent_retry": true
      },
      "expected": {
        "action": "RETRY"
      }
    },
    {
      "name": "stop_retry_when_max_attempts_reached",
      "input": {
        "method": "GET",
        "attempt": 3,
        "error": "NetworkError"
      },
      "expected": {
        "action": "FAIL"
      }
    },
    {
      "name": "retry_on_server_error_second_attempt",
      "input": {
        "method": "GET",
        "attempt": 2,
        "error": "NetworkError"
      },
      "expected": {
        "action": "RETRY",
        "next_attempt": 3
      }
    }
  ]
}
